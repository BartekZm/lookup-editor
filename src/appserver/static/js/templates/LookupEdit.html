<div class="lookup-edit-view">

	<div class="lookup-header">
		<h2>
			<a href="lookup_list">Lookups</a>
		</h2>
		<h2>/ <% if(is_new) { %>New Lookup<% } else { %><%- lookup_name %><% } %></h2>
	</div>

	<% if(lookup_type === "kv") { %>
		<div class="modification-time-holder pull-right">
			<div class="mod-time-icon">
				<i class="icon-circle-filled hide"></i>
			</div>
			<span id="modification-time">Changes are automatically saved in real-time</span>
		</div>
	<% } %>

<div tabindex="-1" id="import-file-modal" class="modal fade in hide">
	    <div class="modal-header">
	        <button type="button" class="close btn-dialog-close" data-dismiss="modal">x</button>
	        <h3>Import File</h3>
	    </div>
	    <div class="modal-body form form-horizontal modal-body-scrolling">

			<div id="import-main">
				<span>
				Import the contents of a CSV file into this lookup file.
				<% if(lookup_type === "kv") { %>
				<div class="paragraph">
				<strong>Note:</strong>
				The CSV file needs to have all of the columns that are defined in this lookup. Extra columns are allowed and will be ignored.
				</div>
				<% } %>
				</span>
				
				<input type="file" id="import-file-input" />
				<button class="btn active btn-primary" id="choose-import-file">Select file to import</button>
				
				<div class="drag-and-drop-tip">
					<strong>Tip:</strong> You can drag and drop a CSV file onto the editor or this dialog to import it directly
				</div>
			</div>

			<div id="import-in-process" style="display:none">
				Please wait while the file is imported into the KV store lookup.
				<div class="progress">
					<div id="import-progress" class="bar" style="width: 0%;"></div>
					<div id="import-error" class="bar bar-warning" style="width: 0%;"></div>
				</div>
			</div>
	        
	    </div>
	    <div class="modal-footer">
	        <a href="#" class="btn btn-dialog-cancel label_from_data" data-dismiss="modal" style="display: inline;">Cancel</a>
	    </div>
</div>

<div class="top-controls">
	<% if(insufficient_permissions) { %>
	<div id="no-permissions-dialog" class="alert alert-warning">
		<i class="icon-alert"></i>
		You don't have permission to edit this lookup file. You need <strong>admin_all_objects</strong> in order to create KV store lookups.
	</div>
	<% } else { %>
	
	<% if(is_new) { %>
		<div class="row-fluid">
				<div class="span8">
					<span id="lookup-name-control-group" class="control-group">
						<div class="top-label show-when-creating">
							<label class="control-label" for="lookup-name">Name:</label>
						</div>
						<div class="controls show-when-creating">
							<div class="input input-text" id="lookup-name"></div>
							<span class="hide help-inline"></span>
							<span class="help-block"><% if(lookup_type === "csv"){ %>Generally ends with ".csv"<% } else { %>Specifies the name of collection<% } %></span>
						</div>
					</span>
					
					<% if(lookup_type === "csv"){ %>
					<span id="user-control-group" class="control-group show-when-creating">
						<div class="input input-checkbox" id="lookup-user-only"></div>
					</span>
					<% } %>
					
					<span id="lookup-app-control-group" class="control-group">
						<div class="top-label show-when-creating">
							<label class="control-label" for="lookup-app">App:</label>
						</div>
						<div class="controls show-when-creating">
							<div class="input input-dropdown" id="lookup-app"></div>
							<span class="hide help-inline"></span>
							<span class="help-block"><% if(lookup_type === "csv"){ %>Specifies the app where the lookup file will reside<% } else { %>Specifies the app where the collection will reside<% } %></span>
						</div>
					</span>
		
					<div id="warning-message" class="alert alert-warning hide">
						<i class="icon-alert"></i>
						<div class="message">Warning!</div>
					</div>
					
					<div id="info-message" class="alert alert-info hide">
						<i class="icon-alert"></i>
						<div class="message">Ok!</div>
					</div>
					<% if(lookup_type === "csv") { %>
					<div class="right-click-help-message show-when-editing"><i class="icon-info-circle" />Right-click the table for editing options</div>
					<% } %>
				</div>
				<div class="span4 show-when-editing">
					<% if(lookup_type === "csv"){ %>
					<div class="btn-group pull-right">
						<button class="btn" id="import-file">Import</button>
					</div>
					<% } %>
				</div>
	<% } else { %>
	<div class="row-fluid">
		<div class="span4">
			<div id="warning-message" class="alert alert-warning hide">
				<i class="icon-alert"></i>
				<div class="message">Warning!</div>
			</div>
			
			<div id="info-message" class="alert alert-info hide">
				<i class="icon-alert"></i>
				<div class="message">Ok!</div>
			</div>
			<div class="right-click-help-message show-when-editing"><i class="icon-info-circle" />Right-click the table for editing options</div>
		</div>
		<div class="span8 show-when-editing">
			<% if(lookup_type === "csv"){ %>
			<div class="btn-group pull-right">
				<button class="btn" id="import-file">Import</button>
				<button class="btn" id="export-file">Export</button>
				<button class="btn" id="refresh">Refresh</button>
				<% if(search_link !== null) { %>
				<a class="btn" target="_blank" href="<%- search_link %>">Open in Search</a>
				<% } %>
				<!-- <button class="btn" id="edit-acl">Edit Permissions</button> -->
				<a class="btn dropdown-toggle right-offset-button" data-toggle="dropdown" href="#">
        			Revert to previous version
        			<span class="caret"></span>
        		</a>
        		<ul id="backup-versions" class="dropdown-menu">
        			<li><a class="backup-version" href="#">No backup versions available</a></li>
        		</ul>
			</div>
			<% } else if(lookup_type === "kv") { %>
				<div id="load-user-context" class="btn-group pull-right right-offset-button">
					<button class="btn" id="import-file">Import</button>
					<button class="btn" id="export-file">Export</button>
					<% if(search_link !== null) { %>
						<a class="btn" target="_blank" href="<%- search_link %>">Open in Search</a>
					<% } else { %>
					<button class="btn" id="open-in-search">Open in Search</button>
					<% } %>
					<button class="btn" id="refresh">Refresh</button>
					<!-- <button class="btn" id="edit-acl">Edit Permissions</button> -->
					<a class="btn dropdown-toggle" data-toggle="dropdown" href="#">
		        		Showing entries for: <span id="loaded-user-context"></span>
		        		<span class="caret"></span>
		        	</a>
		        	<ul class="dropdown-menu">
		        		<% for(var c = 0; c < users.length; c++){ %>
		        			<li>
		        				<a class="user-context" href="#" data-user="<%- users[c].name %>">
		        				<%- users[c].readable_name %>
		        				
		        				<% if(users[c].description){ %>
		        					(<%- users[c].description %>)
		        				<% } %>
		        				</a>
		        			</li>
		        		<% } %>
		        	</ul>
	        	</div>
			<% } %>
			</div>
		</div>
	<% } %>
</div>
	
<div id="lookup-table" class="editing-content"></div>

<button class="btn btn-primary pull-right editing-content <% if(lookup_type === "kv" && !is_new ){ %>hide<% } %>" id="save">Save Lookup</button>
<% } %>
</div>
<div id="lookup-kv-store-edit" class="hide editing-content"></div>
<div id="lookup-transform-modal"></div>